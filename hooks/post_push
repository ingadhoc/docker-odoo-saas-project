#!/bin/bash
set -ex

# We append BUILD_DATE to the image tag.
BUILD_DATE=`date -u +%Y.%m.%d`
TAG="$DOCKER_REPO:$DOCKER_TAG"

# Push dev image "ex: odoo-adhoc:18.0.dev"
docker push "$TAG.dev"

# Push prod image "ex: odoo-adhoc:18.0.2025.01.09"
docker tag "$TAG" "$TAG.$BUILD_DATE"
docker push "$TAG.$BUILD_DATE"

# Push dev image "ex: odoo-adhoc:18.0.2025.01.09.dev"
docker tag "$TAG.dev" "$TAG.$BUILD_DATE.dev"
docker push "$TAG.$BUILD_DATE.dev"
